import { color } from './color.js';
import { getModeColor } from './mode.js';

let b;if(process.env.ROBO_SHARD_MODE){const n=process.env.ROBO_SHARD_MODE,r=process.env.ROBO_SHARD_LONGEST_MODE,e=getModeColor(n);b=color.bold(color.dim(e(n.padEnd(r.length))));}const y=process.env.NODE_ENV!=="production",E=/\x1b\[.*?m/g,h=new Set;function x(){return typeof window<"u"&&typeof document<"u"}let d=null,f=null;function A(){return d?Promise.resolve(d):f||(f=import('node:util').then(n=>(d=n.inspect,d)),f)}function R(n,r=.6){if(n.startsWith("#")&&(n.length===7||n.length===4)){if(n.length===7){const e=parseInt(n.slice(1,3),16),t=parseInt(n.slice(3,5),16),s=parseInt(n.slice(5,7),16),a=Math.round(e*r),c=Math.round(t*r),l=Math.round(s*r);return "#"+[a,c,l].map(u=>u.toString(16).padStart(2,"0")).join("")}else if(n.length===4){const e=parseInt(n.charAt(1)+n.charAt(1),16),t=parseInt(n.charAt(2)+n.charAt(2),16),s=parseInt(n.charAt(3)+n.charAt(3),16),a=Math.round(e*r),c=Math.round(t*r),l=Math.round(s*r);return "#"+[a,c,l].map(u=>u.toString(16).padStart(2,"0")).join("")}}return n}function _(n,r){if(!n||n==="none")return r;const e=n.split(/\s+/);return e.includes(r)?n:e.concat(r).join(" ")}function m(n,r){return n?n.split(/\s+/).filter(t=>t!==r).join(" "):""}function D(n,r){const e={...n};switch(r){case"0":return {};case"1":e["font-weight"]="bold";break;case"2":e.color?e.color=R(e.color,.6):e.color="#999999";break;case"3":e["font-style"]="italic";break;case"4":e["text-decoration"]=_(e["text-decoration"],"underline");break;case"7":e.filter="invert(100%)";break;case"8":e.visibility="hidden";break;case"9":e["text-decoration"]=_(e["text-decoration"],"line-through");break;case"22":delete e["font-weight"];break;case"23":delete e["font-style"];break;case"24":e["text-decoration"]=m(e["text-decoration"],"underline");break;case"27":delete e.filter;break;case"28":e.visibility="visible";break;case"29":e["text-decoration"]=m(e["text-decoration"],"line-through");break;case"30":e.color="black";break;case"31":e.color="#F44336";break;case"32":e.color="#4CAF50";break;case"33":e.color="#FFEB3B";break;case"34":e.color="#2196F3";break;case"35":e.color="#FF4081";break;case"36":e.color="#00E5FF";break;case"37":e.color="white";break;case"39":e.color="inherit";break;case"90":e.color="#9E9E9E";break;case"91":e.color="#FF5252";break;case"92":e.color="#69F0AE";break;case"93":e.color="#FFD700";break;case"94":e.color="#448AFF";break;case"95":e.color="#EA80FC";break;case"96":e.color="#18FFFF";break;case"97":e.color="#FFFFFF";break;case"40":e["background-color"]="black";break;case"41":e["background-color"]="#F44336";break;case"42":e["background-color"]="#4CAF50";break;case"43":e["background-color"]="#FFEB3B";break;case"44":e["background-color"]="#2196F3";break;case"45":e["background-color"]="#E91E63";break;case"46":e["background-color"]="#00E5FF";break;case"47":e["background-color"]="white";break;case"49":e["background-color"]="inherit";break;case"100":e["background-color"]="#9E9E9E";break;case"101":e["background-color"]="#FF5252";break;case"102":e["background-color"]="#69F0AE";break;case"103":e["background-color"]="#FFD700";break;case"104":e["background-color"]="#448AFF";break;case"105":e["background-color"]="#EA80FC";break;case"106":e["background-color"]="#18FFFF";break;case"107":e["background-color"]="#FFFFFF";break;}return e}function I(n){let r="";const e=[];let t=0,s={};const a=/\x1b\[([0-9;]+)m/g;let c;for(;(c=a.exec(n))!==null;){if(c.index>t){const u=n.slice(t,c.index).replace(/%/g,"%%");r+="%c"+u,e.push(v(s));}const l=c[1].split(";");for(const u of l)s=D(s,u);t=a.lastIndex;}if(t<n.length){const l=n.slice(t).replace(/%/g,"%%");r+="%c"+l,e.push(v(s));}return e.length===0?{fmt:n,css:[]}:{fmt:r,css:e}}function v(n){return Object.entries(n).map(([r,e])=>`${r}: ${e}`).join("; ")}async function k(n,...r){const e=await A(),t=r.map(s=>typeof s=="object"||s instanceof Error||Array.isArray(s)?e(s,{colors:!0,depth:null}):s);return new Promise((s,a)=>{n.write(t.join(" ")+`
`,"utf8",c=>{c?a(c):s();});})}function w(n,r,...e){if(x()){const t=e.join(" "),{fmt:s,css:a}=I(t);return r==="warn"||r==="error"?console.error(s,...a):console.log(s,...a),Promise.resolve()}switch(r){case"trace":case"debug":case"info":case"wait":case"event":return k(process.stdout,...e);case"warn":case"error":return k(process.stderr,...e);default:return k(process.stdout,...e)}}const O=100;class B{level;timestamp;data;constructor(r,e){this.level=r,this.data=e,this.timestamp=new Date;}message(){return this.data.map(e=>{if(e instanceof Error)return e.message;if(typeof e=="object")try{return JSON.stringify(e)}catch{return "[unserializable object]"}return e}).join(" ").replace(E,"")}}class p{_customLevels;_enabled;_level;_levelValues;_parent;_prefix;_currentIndex;_drain;_logBuffer;constructor(r){this.setup(r);}setup(r){const{customLevels:e,drain:t=w,enabled:s=!0,level:a,parent:c,prefix:l}=r??{};this._customLevels=e,this._drain=t,this._enabled=s,this._parent=c,this._prefix=l,process.env.ROBOPLAY_ENV?this._level="trace":this._level=a??"info",this._levelValues={...S,...Object.fromEntries(Object.entries(this._customLevels??{}).map(([u,L])=>[u,L.priority]))},this._currentIndex=0,this._logBuffer=new Array(r?.maxEntries??O);}_log(r,e,...t){if(this._parent)return this._parent._log(this._prefix,e,...t);if(!this._enabled||this._drain===w&&this._levelValues[this._level]>this._levelValues[e])return;if(e!=="other"){let c=((this._customLevels?this._customLevels[e]?.label:P[e])??e.padEnd(5))+" -";r&&(c=color.bold(M[e](r+":"))+c),t.unshift(c);}b!==void 0&&t.length>1&&t.unshift(b),y&&(this._logBuffer[this._currentIndex]=new B(e,t),this._currentIndex=(this._currentIndex+1)%this._logBuffer.length);const s=this._drain(this,e,...t);h.add(s),s.finally(()=>{h.delete(s);});}async flush(){if(this._parent)return this._parent.flush();await Promise.allSettled([...h]);}fork(r){return new p({customLevels:this._customLevels,enabled:this._enabled,level:this._level,parent:this,prefix:this._prefix?this._prefix+r:r})}getLevel(){return this._parent?this._parent.getLevel():this._level}getLevelValues(){return this._parent?this._parent.getLevelValues():this._levelValues}getRecentLogs(r=50){if(this._parent)return this._parent.getRecentLogs(r);if(r<=0)return [];r=Math.min(r,this._logBuffer.length);const e=(this._currentIndex-r+this._logBuffer.length)%this._logBuffer.length;let t;return e<this._currentIndex?t=this._logBuffer.slice(e,this._currentIndex):t=this._logBuffer.slice(e).concat(this._logBuffer.slice(0,this._currentIndex)),t.reverse()}setDrain(r){this._drain=r;}trace(...r){this._log(null,"trace",...r);}debug(...r){this._log(null,"debug",...r);}info(...r){this._log(null,"info",...r);}wait(...r){this._log(null,"wait",...r);}log(...r){this._log(null,"other",...r);}event(...r){this._log(null,"event",...r);}ready(...r){this._log(null,"ready",...r);}warn(...r){this._log(null,"warn",...r);}error(...r){this._log(null,"error",...r);}custom(r,...e){this._customLevels?.[r]&&this._log(null,r,...e);}}const S={trace:0,debug:1,info:2,wait:3,other:4,event:5,ready:6,warn:7,error:8},M={trace:color.gray,debug:color.cyan,info:color.blue,wait:color.cyan,event:color.magenta,ready:color.green,warn:color.yellow,error:color.red},P={trace:color.gray("trace".padEnd(5)),debug:color.cyan("debug".padEnd(5)),info:color.blue("info".padEnd(5)),wait:color.cyan("wait".padEnd(5)),event:color.magenta("event".padEnd(5)),ready:color.green("ready".padEnd(5)),warn:color.yellow("warn".padEnd(5)),error:color.red("error".padEnd(5))};let g=null;function o(n){return !g&&n?g=new p(n):g?n&&g.setup(n):g=new p,g}o.flush=async function(){await o().flush();},o.fork=function(n){return o().fork(n)},o.getRecentLogs=function(n=25){return o().getRecentLogs(n)},o.trace=function(...n){return o().trace(...n)},o.debug=function(...n){return o().debug(...n)},o.info=function(...n){return o().info(...n)},o.wait=function(...n){return o().wait(...n)},o.log=function(...n){return o().log(...n)},o.event=function(...n){return o().event(...n)},o.ready=function(...n){return o().ready(...n)},o.warn=function(...n){return o().warn(...n)},o.error=function(...n){return o().error(...n)},o.custom=function(n,...r){return o().custom(n,...r)};

export { E as ANSI_REGEX, y as DEBUG_MODE, p as Logger, w as consoleDrain, o as logger };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=logger.js.map